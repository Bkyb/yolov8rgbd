# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license

# Ultralytics YOLO11-pose keypoints/pose estimation model with P3/8 - P5/32 outputs
# Model docs: https://docs.ultralytics.com/models/yolo11
# Task docs: https://docs.ultralytics.com/tasks/pose

# Parameters
nc: 80 # number of classes
kpt_shape: [9, 3] # number of keypoints, number of dims (2 for x,y or 3 for x,y,visible)
scales: # model compound scaling constants, i.e. 'model=yolo11n-pose.yaml' will call yolo11.yaml with scale 'n'
  # [depth, width, max_channels]


# YOLO11n backbone
# scales:
#   ...
#   # P3(64), P4(96), P5(960) ì±„ë„ì— ë§ê²Œ ì •ì˜
#   mnv4s: [1.0, 1.0, [64, 96, 960]] 

backbone:
  # 1. ë°±ë³¸ (out_indices=[2, 3, 4] -> P3, P4, P5 ë°˜í™˜)
  - [-1, 1, TimmBackbone, ['mobilenetv4_conv_small', True, [2, 3, 4]]]  # 0ë²ˆ

  # 2. SelectFeatureë¡œ P3, P4, P5 í”¼ì²˜ë§µ ë¶„ë¦¬
  - [0, 1, SelectFeature, [0, 64]]   # 1ë²ˆ (P3/8, 64ch)
  - [0, 1, SelectFeature, [1, 96]]   # 2ë²ˆ (P4/16, 96ch)
  - [0, 1, SelectFeature, [2, 960]]  # 3ë²ˆ (P5/32, 960ch)
  - [-1, 1, Conv, [256, 1, 1]]      # 4ë²ˆ (P5-reduced, 256ch)

  # 3. P5 í”¼ì²˜ë§µì— SPPF, C2PSA ì ìš© (ì±„ë„ ìˆ˜ 960ìœ¼ë¡œ ìˆ˜ì •)
  - [-1, 1, SPPF, [256, 5]]         # 5ë²ˆ (from 4)
  - [-1, 2, C2PSA, [256]] # 10

head:
  # ë„¥(Neck)ì˜ ì—°ê²° ì¸ë±ìŠ¤ê°€ 3ë²ˆ -> 5ë²ˆìœ¼ë¡œ ë³€ê²½ë¨

  # 3. PANet (Top-down)
  - [-1, 1, nn.Upsample, [None, 2, 'nearest']] # 7 (from 6, P5 ìµœì¢…)
  - [[-1, 2], 1, Concat, [1]]  # 8 <- P4(2ë²ˆ)ì™€ Concat
  - [-1, 2, C3k2, [96, False]] # 9 (P4-neck, 96ch) 

  - [-1, 1, nn.Upsample, [None, 2, 'nearest']] # 10 (from 9)
  - [[-1, 1], 1, Concat, [1]]  # 11 <- P3(1ë²ˆ)ì™€ Concat
  - [-1, 2, C3k2, [64, False]] # 12 (P3-small, 64ch)

  # 4. PANet (Bottom-up)
  - [-1, 1, Conv, [64, 3, 2]] # 13 (from 12)
  - [[-1, 9], 1, Concat, [1]]  # 14 <- P4-neck(8ë²ˆ)ì™€ Concat
  - [-1, 2, C3k2, [96, False]] # 15 (P4-medium, 96ch)

  - [-1, 1, Conv, [96, 3, 2]] # 16 (from 15)
  - [[-1, 6], 1, Concat, [1]]  # 17 <- P5 ìµœì¢…(5ë²ˆ)ì™€ Concat
  - [-1, 2, C3k2, [256, True]] # 18 (P5-large, 256ch)

  # 5. Pose Head
  - [[12, 15, 18], 1, Pose, [nc, kpt_shape]] # Detect(P3, P4, P5)